<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCP æª”æ¡ˆç€è¦½å™¨ç¤ºç¯„ (ç®¡ç†å“¡)</title> <link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">

    <style>
        /* ... æ‚¨çš„ CSS æ¨£å¼ ... (ä¿æŒä¸è®Š) ... */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 20px; background-color: #f4f6f6; }
        .container { max-width: 900px; margin: 0 auto; background: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h1, h2 { color: #333; }
        /* éš±è— controls å€å¡Šï¼Œå› ç‚ºä¸å†éœ€è¦è¼¸å…¥æ¡† */
        .controls { display: none; } 
        #file-browser { border: 1px solid #eee; padding: 15px; min-height: 200px; background: #fafafa; border-radius: 4px; }
        #file-browser div { padding: 8px; cursor: pointer; border-bottom: 1px solid #eee; }
        #file-browser div:hover { background-color: #e9f5ff; }
        #file-browser div:last-child { border-bottom: none; }
        #loading { display: block; color: #777; } /* é è¨­é¡¯ç¤ºè¼‰å…¥ä¸­ */

        df-messenger {
            /* ... (DF Messenger æ¨£å¼ä¿æŒä¸è®Š) ... */
            z-index: 999; position: fixed; --df-messenger-font-color: #000;
            --df-messenger-font-family: Google Sans; --df-messenger-chat-background: #f3f6fc;
            --df-messenger-message-user-background: #d3e3fd; --df-messenger-message-bot-background: #fff;
            bottom: 16px; right: 16px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>æˆ‘çš„é›²ç«¯æª”æ¡ˆ (ç®¡ç†å“¡æ¨¡å¼)</h1>
        <div class="controls">
            <input type="text" id="user-id-input" placeholder="è¼¸å…¥æ‚¨çš„ ID (ä¾‹å¦‚: demo_student_01 æˆ– alex_chen)">
            <button id="load-files-btn">è¼‰å…¥æª”æ¡ˆ</button>
        </div>
        <h2>æ‰€æœ‰ç”¨æˆ¶æª”æ¡ˆåˆ—è¡¨</h2>
        <div id="file-browser">
            <div id="loading">è¼‰å…¥ä¸­...</div>
            <div id="file-list"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>
    <df-messenger
      location="us-central1"
      project-id="chatbot-with-ibm"
      agent-id="5fc06c04-a4cb-4c27-bb00-4935882b0c0b"
      language-code="en"
      max-query-length="-1">
      <df-messenger-chat-bubble
        chat-title="course advirser">
      </df-messenger-chat-bubble>
    </df-messenger>

    <script>
        // ! å¿…é ˆä¿®æ”¹ç‚ºæ‚¨ "æ–°çš„" ç®¡ç†å“¡ API URL
        // ! ä¹Ÿå°±æ˜¯ "list_all_files_admin_http" çš„è§¸ç™¼ URL
        const ADMIN_API_URL = "https://list-gcs-folders-448262279430.northamerica-northeast2.run.app/list_all_files_admin_http"; 

        const fileListDiv = document.getElementById('file-list');
        const loadingDiv = document.getElementById('loading');
        // (å·²ç§»é™¤è¼¸å…¥æ¡†å’ŒæŒ‰éˆ•çš„äº‹ä»¶ç›£è½)

        async function loadAllFiles() {
            fileListDiv.innerHTML = '';
            loadingDiv.style.display = 'block';

            try {
                // å‘¼å«æ–°çš„ ADMIN_API_URLï¼Œä¸éœ€è¦ user_id
                const response = await fetch(ADMIN_API_URL); 
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP éŒ¯èª¤: ${response.status}`);
                }
                const data = await response.json();
                loadingDiv.style.display = 'none';

                // æ–°çš„ API åªæœƒå›å‚³ 'files' åˆ—è¡¨
                if (data.files && data.files.length > 0) {
                    data.files.forEach(file => {
                        const item = document.createElement('div');
                        // é¡¯ç¤ºåœ–ç¤ºå’ŒåŒ…å«ç”¨æˆ¶è³‡æ–™å¤¾çš„æª”æ¡ˆè·¯å¾‘
                        item.innerHTML = `ğŸ“„ ${file}`; 
                        item.onclick = () => alert(`é»æ“Šäº†æª”æ¡ˆ: ${file}`);
                        fileListDiv.appendChild(item);
                    });
                } else {
                    fileListDiv.innerHTML = '<div>' + (data.files ? 'GCS "users/" è³‡æ–™å¤¾ä¸­æ²’æœ‰ä»»ä½•æª”æ¡ˆã€‚' : 'æœªæ”¶åˆ°é æœŸçš„æª”æ¡ˆè³‡æ–™ã€‚') + '</div>';
                }
            } catch (error) {
                loadingDiv.style.display = 'none';
                fileListDiv.innerHTML = `<div style="color: red;">è¼‰å…¥å¤±æ•—: ${error.message}</div>`;
                console.error('Fetch error:', error);
            }
        }

        // *** é€™è£¡çš„ç¨‹å¼ç¢¼å·²ä¿®æ”¹ ***
        // é é¢è¼‰å…¥å®Œæˆå¾Œï¼Œè‡ªå‹•åŸ·è¡Œ
        window.addEventListener('DOMContentLoaded', () => {
            loadAllFiles(); // è‡ªå‹•å‘¼å«è¼‰å…¥æ‰€æœ‰æª”æ¡ˆçš„å‡½å¼
        });

    </script>
</body>
</html>